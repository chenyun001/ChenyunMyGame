---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Jonny.
--- DateTime: 2021/1/22 16:06
---

local http = require 'ext/luasocket/http'
local ltn12 = require 'ext/luasocket/ltn12'
local http_util = {}
http.TIMEOUT = 5

function http_util.get(url, cb, timeout_cb, err_cb)
    local b, c, h, s = http.request(url)
    if c == 'timeout' or b == nil then
        print("【请求超时】" .. url)
        MessageTips.Show("请求超时,请检查网络连接")

        if timeout_cb ~= nil then
            timeout_cb()
        end
    else
        if c == 200 then
            if cb ~= nil then
                cb(b)
            end
        else
            --MessageTips.Show("errMsg":"账号已存在"
            if err_cb ~= nil then
                err_cb()
            end
        end

    end
end

function http_util.post(url, cb, data, timeout_cb, err_cb)
    local response_body = {}
  
    local b, c, h, s = http.request {
        url = url,
        method = "POST",
        headers =
        {
            ["Content-Type"] = "application/x-www-form-urlencoded";
            ["Content-Length"] = #data;
        },
        source = ltn12.source.string(data),
        sink = ltn12.sink.table(response_body),
    }
   
    if c == 'timeout' or b == nil then
        print("【请求超时】" .. url)
        MessageTips.Show("请求超时,请检查网络连接")
        if timeout_cb ~= nil then
            timeout_cb()
        end
    else
        if c == 200 then
            if cb ~= nil then
                cb(response_body[1])
            end
        else
            if err_cb ~= nil then
                err_cb()
            end
        end
    end
end

function http_util.post_json(url, cb, data, timeout_cb, err_cb,token)
    dump(token,"------token---------")
    local response_body = {}
    local b, c, h, s = http.request {
        url = url,
        method = "POST",
        headers = {
            ["Content-Type"] = "application/json";
            ["YqAuthorization"] = token;
            ["Content-Length"] = #data
        },
        source = ltn12.source.string(data),
        sink = ltn12.sink.table(response_body),
    }
    if c == 'timeout' or b == nil then
        print("【请求超时】" .. url)
        MessageTips.Show("请求超时,请检查网络连接")
        if timeout_cb ~= nil then
            timeout_cb()
        end
    else
        if c == 200 then
            if cb ~= nil then
                cb(response_body[1])
            end
        else
            if err_cb ~= nil then
                err_cb()
            end
        end
    end
end

return http_util