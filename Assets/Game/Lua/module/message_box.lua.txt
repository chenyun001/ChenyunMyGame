---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Jonny.
--- DateTime: 2021/1/10 15:39
---

local Box = typesys.def.MessageBox {
    __super = typesys.Panel,

    btn_group_1 = typesys.__unmanaged,
    btn_group_2 = typesys.__unmanaged,
    btn_1_ok = typesys.__unmanaged,
    btn_2_ok = typesys.__unmanaged,
    btn_2_cancel = typesys.__unmanaged,
    tmp_content = typesys.__unmanaged,
}

local messageBoxType
local btn_ok
local btn_cancel

function Box:awake()
    self.tmp_content = self.tmp_content:GetComponent(typeof(UnityEngine.UI.Text))
    messageBoxType = MailingJoy.Game.Modules.Message.MessageBoxType
    local has_ok = self.param.MessageBoxType & messageBoxType.Ok == messageBoxType.Ok
    local has_cancel = self.param.MessageBoxType & messageBoxType.Cancel == messageBoxType.Cancel

    if has_ok and has_cancel then
        self.btn_group_1:SetActive(false)
        self.btn_group_2:SetActive(true)
        btn_ok = self.btn_2_ok
        btn_cancel = self.btn_2_cancel
    else
        self.btn_group_1:SetActive(true)
        self.btn_group_2:SetActive(false)
        btn_ok = self.btn_1_ok
    end
end

function Box:start()
    self.tmp_content.text = self.param.Message
    if string.len(self.param.Message) < 50 then
        self.tmp_content.alignment = UnityEngine.TextAnchor.MiddleCenter;
    end
    if btn_ok ~= nil then
        btn_ok.onClick:AddListener(function()
            self:on_click(messageBoxType.Ok)
        end)
    end

    if btn_cancel ~= nil then
        btn_cancel.onClick:AddListener(function()
            self:on_click(messageBoxType.Cancel)
        end)
    end
end

function Box:on_click(selected_type)
    if self.param.CallbackHandle ~= nil then
        self.param.CallbackHandle(selected_type)
    end
    GameUIManager:CloseUI(typeof(MessageBox))
end

function Box:destroy()
    self:release()
    if btn_ok ~= nil then
        btn_ok.onClick:RemoveAllListeners()
    end
    if btn_cancel ~= nil then
        btn_cancel.onClick:RemoveAllListeners()
    end
    messageBoxType = nil
    btn_ok = nil
    btn_cancel = nil
end

function Box:update(delta_time)

end

return Box